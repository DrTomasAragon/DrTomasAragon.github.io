<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tomás Aragón">
<meta name="dcterms.date" content="2018-06-11">
<meta name="description" content="Most of what we know about our emotions (and how our brains work) is just plain wrong—and sometimes harmful!">

<title>Dr.&nbsp;Tomás Aragón - How emotions are made: The secret life of the brain</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-111617948-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Dr.&nbsp;Tomás Aragón - How emotions are made: The secret life of the brain">
<meta name="twitter:description" content="Most of what we know about our emotions (and how our brains work) is just plain wrong—and sometimes harmful!">
<meta name="twitter:image" content="https://drtomasaragon.github.io/posts/2018-06-15-how-emotions-are-made/images/feature.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Dr.&nbsp;Tomás Aragón</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../works.html" rel="" target="">
 <span class="menu-text">Works</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../subscription.html" rel="" target="">
 <span class="menu-text">Subscribe</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://threads.net/drtomasaragon" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/drtomasaragon" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/drtomasaragon" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">How emotions are made: The secret life of the brain</h1>
                  <div>
        <div class="description">
          <p>Most of what we know about our emotions (and how our brains work) is just plain wrong—and sometimes harmful!</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Book review</div>
                <div class="quarto-category">Emotions</div>
                <div class="quarto-category">Neuroscience</div>
                <div class="quarto-category">Psychology</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://taragonmd.github.io">Tomás Aragón</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              California Department of Public Health
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 11, 2018</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Most of what we know about our emotions (and how our brains work) is just plain wrong—and sometimes harmful! <em>Myth:</em> our emotions are hard-wired by evolution in our “limbic” (“reptilian”) brain and emotions are “triggered.” <em>Myth:</em> across the globe humans have universal facial expressions for core emotions (e.g., joy causes smiling). <em>Myth:</em> we control our emotions with our “rational” (neocortex) brain. <em>Myth:</em> the amygdala is the “fear center” of the brain. <em>Myth:</em> we can learn to read others’ emotions with reliability. <em>Myth:</em> seeing is believing. <em>Myth:</em> we cannot go wrong trusting our “gut” feeling.</p>
<p>Reading Lisa Feldman Barrett’s <a href="http://a.co/2rjaHS5"><em>How Emotions are Made: The secret life of the brain</em></a> was transformative. Our emotions, brain, and body do not function as depicted by <a href="https://lisafeldmanbarrett.com/category/myths-about-the-brain/">brain science myths</a> that have been debunked, but persist because scientists, health professionals, and the “emotion,” “emotional-intelligence,” and “brain science” industries are not current with the latest neuroscience. This book will set you on the right course.</p>
<p>At birth, the brain is a blank slate awaiting “wiring instructions” from a caregiver. Every second we are alive the brain processes “big data” of sensory input from our body (through <a href="https://en.wikipedia.org/wiki/Interoception">interoception</a>) and from the external world (through our senses: sight, hearing, touch, smell, and taste). Through evolution, humans solved a neurobio-engineering problem: how do we efficiently procure and balance energy <em>and</em> accumulate learnings on how to survive and procreate. The brain evolved into a <strong>predictive learning machine</strong>. The memories we accumulate through experiences become the predictions (“hypotheses” or “priors”) that the brain compares to new sensory input (“evidence”). The gap between prediction and sensory input is <strong>prediction error</strong>. If the prediction error is small or negligible the brain accepts the prediction, thereby saving cognitive energy expenditure. If the prediction error is large (e.g., cognitive dissonance), the brain must choose either to accept the prediction (cognitively and energy efficient, so our brain <em>strongly</em> prefers this), or to learn (cognitively and energy inefficient, so our brain <em>strongly</em> resists this).</p>
<p>The brain must make meaning of this sensory input in order to prepare for what the body needs to do next (based on prior experiences) to survive, etc. The brain prepares the body to respond through our nervous, cardiovascular, immune, endrocrine, and musculoskeletal systems. <strong>Emotions are the on-the-spot meanings</strong> the brain gives to these external and internal sensory input (bodily sensations). “In other words, emotions are your brain’s best guess of how you should feel in the moment. Emotions aren’t wired into your brain like little circuits; they’re made on demand. As a result, you have more control over your emotions than you might think.”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>All of this happens automatically at a nonconscious level: that is why it “feels” like our emotions are “triggered.” In fact, <em>our emotions are constructed in the moment</em> based on:</p>
<ol type="1">
<li><strong>sensory input</strong> (from body [interoception] and surroundings [exteroception], includes social environmental context),</li>
<li><strong>goal</strong> (survive, human drives, etc.),</li>
<li><strong>predictions</strong> (memories accumulated from prior experiences).<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ol>
<p>The implications of understanding this evolution-designed engineering achievement are huge! How the brain processes the big data of sensory input also provides lessons on how we should process the new big data we are accumulating in the “cloud.” (Hint: read my <a href="https://taragonmd.github.io/tags/book-review/">book review</a> of Judea Pearl’s <em>The Book of Why: The New Science of Cause and Effect</em>.)</p>
<section id="designing-an-emotionally-fulfilling-life" class="level2">
<h2 class="anchored" data-anchor-id="designing-an-emotionally-fulfilling-life">Designing an emotionally fulfilling life</h2>
<p>Even today, we are taught, incorrectly, that emotions are hardwired by evolution and that we should “control” (i.e., suppress), accept (i.e., embrace), or release emotions. For example, someone or something “triggers” an emotion and a stress response (“fight-flight-freeze”) in us, and we can use mindfulness to notice, acknowledge, and “release” this emotion. Yes, mindfulness works; however, <em>mindfulness is much more powerful when we understand that emotions are acutually constructed rathered than “triggered.”</em></p>
<p>We have the power to design and build an emotionally fulfilling life by the experiences we choose to have and the cognitive and motor memories we encode in our brains. <em>This explains how “doing” rewires the brain!</em> Interestingly, <strong>Buddhism</strong><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> practices (e.g., mindfulness meditation) align nicely with this modern scientific understanding of brain and emotions. For example, Dr.&nbsp;Barrett studies and describes how Buddhism can strengthen interpersonal relationships and improve your brain and body health.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Mindfulness promotes stillness, awareness, and being in the moment without judgment or expectation. Then, we can exercise curiosity about what contributed or is contributing to our feelings (affect) and emotions (meaning). This is critical because <em>our brains are quick to draw false conclusions</em> to save cognitive energy rather than to “get it right.” Interestingly, the more vocabulary we have to describe feelings and emotions, the more ability we have to recognize these in ourselves and others. This is called <em>emotional granularity</em> and is the actual basis of emotional intelligence.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>Dr.&nbsp;Barrett’s <a href="http://a.co/2rjaHS5">How Emotions are Made</a> covers many practical applications of this emerging science, including mitigating implicit racial bias.</p>
</section>
<section id="key-resources-from-dr.-lisa-feldman-barrett" class="level2">
<h2 class="anchored" data-anchor-id="key-resources-from-dr.-lisa-feldman-barrett">Key resources from Dr.&nbsp;Lisa Feldman Barrett</h2>
<p>Dr.&nbsp;Feldman Barrett’s book covers a lot of content. To get you oriented, I recommend first watching the three videos below. The first video is 5 minutes, followed by two TED talks by LFB.</p>
<section id="this-is-why-you-feel-the-way-you-feel" class="level3">
<h3 class="anchored" data-anchor-id="this-is-why-you-feel-the-way-you-feel">1: This is why you feel the way you feel</h3>
<p>This is an outstanding 5-minute summary of construction of emotions:</p>
<div style="text-align: center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/M1OdhdI_3eI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
</section>
<section id="ted-you-arent-at-the-mercy-of-your-emotions-your-brain-creates-them" class="level3">
<h3 class="anchored" data-anchor-id="ted-you-arent-at-the-mercy-of-your-emotions-your-brain-creates-them">2 (TED): You aren’t at the mercy of your emotions: Your brain creates them</h3>
<p>“Can you look at someone’s face and know what they’re feeling? Does everyone experience happiness, sadness and anxiety the same way? What are emotions anyway? For the past 25 years, psychology professor Lisa Feldman Barrett has mapped facial expressions, scanned brains and analyzed hundreds of physiology studies to understand what emotions really are. She shares the results of her exhaustive research—and explains how we may have more control over our emotions than we think.”</p>
<div style="text-align: center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/0gks6ceq4eQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
<p>See <a href="https://www.ted.com/talks/lisa_feldman_barrett_you_aren_t_at_the_mercy_of_your_emotions_your_brain_creates_them/reading-list">reading list</a> for above TED talk.</p>
</section>
<section id="ted-cultivating-wisdom-the-power-of-mood" class="level3">
<h3 class="anchored" data-anchor-id="ted-cultivating-wisdom-the-power-of-mood">3 (TED): Cultivating Wisdom: The Power of Mood</h3>
<p>“Do you believe that what you see influences how you feel? Actually, the opposite is true: What you feel—your <em>affect</em>—influences what you see, hear, smell, taste, and touch. Psychologist and neuroscientist Lisa Feldman Barrett shares the groundbreaking discovery that you experience the world through affect-colored glasses. She also reveals how affect can be a source of wisdom that helps you to make better, wiser choices”</p>
<div style="text-align: center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/ZYAEh3T5a80" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
</section>
<section id="how-emotions-are-made-cinematic-lecture" class="level3">
<h3 class="anchored" data-anchor-id="how-emotions-are-made-cinematic-lecture">4 How Emotions are Made (Cinematic Lecture)</h3>
<p>Emotions don’t happen to you. They are made by your predictive brain, in specific situations: a brain that feels affect and makes concepts absorbed from your life experience while conversing with your body + the world around you.</p>
<p>This cinematic lecture by Professor Lisa Feldman Barrett is based off her book of the same name.</p>
<div style="text-align: center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/0rbyC5m557I" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">
</iframe>
</div>
</section>
<section id="lfbs-website-includes-numerous-academic-lectures" class="level3">
<h3 class="anchored" data-anchor-id="lfbs-website-includes-numerous-academic-lectures">LFB’s website (includes numerous academic lectures)</h3>
<p>Here is her website with a wealth of material: <a href="https://lisafeldmanbarrett.com/" class="uri">https://lisafeldmanbarrett.com/</a>.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Barrett LF. <em>The science of making emotions: Three main ingredients contribute to how and why the brain creates feelings</em>. HealthyLivingMadeSimple.com. Available from <a href="http://healthylivingmadesimple.com/science-making-emotions/" class="uri">http://healthylivingmadesimple.com/science-making-emotions/</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For example, <strong>implicit bias</strong> is a biased prediction stereotype that operates at a nonconscious level.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><em>Buddha’s Brain: The Practical Neuroscience of Happiness, Love, and Wisdom</em> by Rick Hanson et al.&nbsp;Link: <a href="http://a.co/7SwSlOm" class="uri">http://a.co/7SwSlOm</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Barrett LF. <em>Buddhists in love: Lovers crave intensity, Buddhists say craving causes suffering. Is it possible to be deeply in love yet truly detached?</em> Aeon (website). June, 4, 2018. Available from: <a href="https://aeon.co/essays/does-buddhist-detachment-allow-for-a-healthier-togetherness" class="uri">https://aeon.co/essays/does-buddhist-detachment-allow-for-a-healthier-togetherness</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Barrett LF. <em>Emotional Intelligence Needs a Rewrite: Think you can read people’s emotions? Think again.</em> Nautilus (website). August 3, 2017. Available from: <a href="http://nautil.us/issue/51/limits/emotional-intelligence-needs-a-rewrite" class="uri">http://nautil.us/issue/51/limits/emotional-intelligence-needs-a-rewrite</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Created with <a href="https://quarto.org">Quarto.org</a>—an open-source scientific and technical publishing system built on <a href="https://pandoc.org/">Pandoc</a>.</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>